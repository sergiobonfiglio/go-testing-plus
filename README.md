<div align="center">

# Go Testing+

Run individual Go tests, sub-tests, and (static) table‑driven test cases directly from the VS Code Test Explorer.  
Early preview – feedback welcome!

</div>

## ✨ Overview
Go Testing+ augments the built‑in VS Code Testing UI to give you fine‑grained control over Go test execution. It statically discovers:

* Test files (`*_test.go`)
* Top‑level test functions (`func TestXxx(t *testing.T)`) 
* Nested `t.Run("case", ...)` sub‑tests (including those generated by simple table‑driven tests)
* Nested table tests (recursive `t.Run` chains)

Then it lets you run exactly the scope you select (single case, whole function, file, or all) via a dedicated run profile: **Go+**.

## ✅ Features
* Automatic discovery & refresh of Go test files (`**/*_test.go`) via file system watchers
* Hierarchical Test Explorer tree: File → Test Function → Sub‑tests / Table test cases
* Run profile: **Go+** (standard run)
* Run single sub‑test without executing siblings (narrow `go test -run '^Full/Test/Path$'` pattern)
* Support for nested table tests (static detection through symbol & reference analysis)
* Parses `go test -json` output and streams relevant lines into the Test Explorer
* Failure message parsing with file & line hyperlink locations
* Keeps existing test results invalidated on file change, re‑parsing on save
* Works with multi‑folder workspaces (patterns generated per workspace folder)

> Note: Dynamic names produced at runtime (string concatenation / computed fields) are not yet fully resolved; they may appear only when executed (see Roadmap).

## 🧰 Requirements
* Go toolchain installed and `go` available on your PATH (Go 1.18+ recommended; earlier versions with `go test -json` should also work)
* Go modules enabled (`GO111MODULE=on` implicitly set if not present)
* VS Code `^1.105.0` (per `engines.vscode`)

## 🚀 Installation
1. Install from the VS Code Marketplace (coming soon) or copy this repo locally and run it with the VS Code Extension Host (F5).
2. Open a Go workspace containing `*_test.go` files.
3. Open the Testing view (Activity Bar → Beaker icon) – the tree should populate automatically.

## 🕹 Usage
| Action | How |
|--------|-----|
| Run a single sub‑test | Right‑click the node → Run Test / click the run icon |
| Run a whole test function | Run icon on the function node |
| Run all tests in a file | Run icon on the file node |
| Run everything | Testing view toolbar → Run All with profile Go+ |

The extension builds an anchored regex for the selected scope and invokes:  
`go test -json -run '^Selected/Test/Hierarchy$'` (or `-run .` for full file).

## 🔍 How It Works (Internals)
1. On activation (workspace contains `*_test.go`), a `TestController` (id: `goTestingPlusController`) is created.
2. Test files are scanned using `vscode.workspace.findFiles` and watched with a `FileSystemWatcher`.
3. For each file: document symbols are inspected; functions beginning with `Test` are added as test items.
4. A lightweight static analysis walks references to each `testing.T` parameter to find `t.Run(...)` calls.
5. Each `t.Run("name", ...)` adds a child test item; table‑driven patterns with struct field lookups are partially resolved to produce per‑case items.
6. Execution builds a full hierarchical test name (`Parent/Sub/...`) and runs a single targeted `go test -json -run '^name$'` in the test file's directory.
7. JSON lines are parsed and mapped back to corresponding `TestItem`s, updating status (started, passed, failed, skipped) and attaching parsed failure locations.

## ⚙ Extension Settings
No user‑configurable settings yet (the `contributes.configuration` section is currently empty). Planned settings (see Roadmap):
* `goTestingPlus.includeBenchmarks` (boolean)
* `goTestingPlus.debugProfileEnabled` (boolean)
* `goTestingPlus.maxOutputBuffer` (number)

## 🧪 Commands & Run Profiles
Currently no custom command palette commands are contributed. The extension creates a single Test Run Profile:
* **Go+** – Standard run (non‑debug) for any selected scope.

Debug support is planned (profile commented out in code).

## 📦 Output & Diagnostics
* Raw `go test -json` events are filtered; package‑level only events are currently ignored.
* Failure parsing extracts file, line, and message using a regex; multi‑line failures are associated with the last known location.
* Output lines starting with standard run markers (`=== RUN`, `--- FAIL|PASS|SKIP`) are suppressed to reduce noise.

## 🛑 Known Limitations / Issues
* Dynamic table test names built from variable concatenation are not resolved (child may be missing in explorer until runtime parsing enhancement is added).
* Always returns a `failed` outcome internally from `goTestRun` regardless of parsed status (bug – future fix to propagate parsed `outcome`).
* Benchmark (`BenchmarkXxx`) and example tests are not yet discovered.
* No debug run profile (commented code present).
* No configuration UI / settings yet.

## 🗺 Roadmap
| Area | Planned Enhancements |
|------|-----------------------|
| Test Name Resolution | Resolve dynamically concatenated names; runtime discovery & injection of missing sub‑tests |
| Debugging | Add Debug profile using Delve via `go test -run` selection |
| Benchmarks | Discover & run `Benchmark*` functions |
| Coverage | Optional `-cover` integration with inline decoration |
| Configuration | User settings for exclusions, concurrency, output throttling |
| Stability | Better error handling & cancellation responsiveness |

## 🤝 Contributing
Contributions are welcome! Until templates are added:
1. Fork & branch (`feat/...` or `fix/...`).
2. Run in watch mode:
	```bash
	npm install
	npm run watch
	```
3. Launch the Extension Host (F5) and test changes.
4. Open a PR describing the change & rationale.

### Dev Scripts
| Script | Purpose |
|--------|---------|
| `npm run watch` | Parallel type checking + esbuild bundle (dev) |
| `npm run compile` | Type check, lint, production bundle (no min yet) |
| `npm run test` | Runs extension tests (placeholder) |

## 🧾 Release Notes
### 0.0.1 (Preview)
* Initial release
* Test discovery (files, functions, nested sub‑tests, simple table tests)
* Single test run via anchored `-run` regex
* JSON output parsing & failure location mapping
* File watcher for incremental updates

## 📄 License
License not yet specified. (Consider adding `LICENSE` – e.g. MIT.)

## 🙋 FAQ
**Q:** Why don't I see some table test cases?  
**A:** Likely their names are computed (string concatenation). Static analysis skips them for now – they'll appear once dynamic discovery lands.

**Q:** Does this replace the official Go extension?  
**A:** No – it is complementary and focused purely on granular test execution.

---
If you find this useful, please ⭐ the repo and open issues for ideas or bugs.

Happy testing! 🧪
